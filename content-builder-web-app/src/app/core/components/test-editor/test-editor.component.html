<div class="flex flex-col w-full h-full overflow-hidden gap-1 p-2">
  <form class="flex flex-col h-full w-full gap-1 p-4 overflow-hidden" [formGroup]="_form" (ngSubmit)="_handleSubmit()">
    <div class="flex gap-1 w-full">
      <mat-form-field appearance="fill" class="grow">
        <mat-label>Наименование</mat-label>
        <input matInput [formControl]="_form.controls.name">
      </mat-form-field>
      <mat-form-field appearance="fill" class="grow">
        <mat-label>Макс. количество ошибок</mat-label>
        <input matInput [formControl]="_form.controls.maxErrors">
      </mat-form-field>
      <mat-form-field appearance="fill" class="grow">
        <mat-label>Проходной балл</mat-label>
        <input matInput [formControl]="_form.controls.minScore" type="number">
        <button mat-icon-button matSuffix type="button" (click)="_calculateMinScore()" [title]="'Автоматически посчитать проходной балл (макс: ' + _totalCorrectScore() + ')'">
          <mat-icon svgIcon="calculator" />
        </button>
        @if (_scoreValidation().type === 'error') {
          <mat-error>{{_scoreValidation().message}}</mat-error>
        }
        @if (_scoreValidation().type === 'warning') {
          <mat-hint style="color: orange;">{{_scoreValidation().message}}</mat-hint>
        }
      </mat-form-field>
    </div>
    <div class="flex gap-1 w-full flex-wrap">
      <mat-checkbox [formControl]="_form.controls.showCorrectAnswer">
        Показывать правильный ответ в вопросах
      </mat-checkbox>
      <mat-checkbox [formControl]="_form.controls.includeToStatistics">
        Тест участвует в статистике
      </mat-checkbox>
      <mat-checkbox [formControl]="_form.controls.showSkipButton">
        Показывать кнопку пропускать
      </mat-checkbox>
      <mat-checkbox [formControl]="_form.controls.showNavigation">
        Показывать навигацию
      </mat-checkbox>
      <mat-checkbox [formControl]="_form.controls.showBackButton">
        Показывать кнопку назад
      </mat-checkbox>
    </div>
    <app-test-conditions-builder [folderId]="_dialogData.parentId!" [formControl]="_form.controls.conditions" />
    <app-test-questions-builder [folderId]="_dialogData.parentId!" [formControl]="_form.controls.questions" />
  </form>
  <div class="grow overflow-auto">

  </div>
  <div class="flex w-full justify-end gap-1">
    <button [disabled]="_form.invalid || !_form.dirty || _isPending()" (click)="_handleSubmit()" type="submit" mat-flat-button color="primary">
      <mat-icon [svgIcon]="_isPending() ? 'spinner' : 'check'" />
      Сохранить
    </button>
    <button mat-button color="warn" (click)="_handleClose()">
      <mat-icon svgIcon="xmark" />
      Закрыть
    </button>
  </div>
</div>
